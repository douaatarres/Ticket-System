pipeline {
  agent   any

  stages { 
    stage('Checkout') {
      steps {
        git url: 'https://github.com/douaatarres/Ticket-System.git'
        sh 'node -v'
        sh 'npm -v'
      }
    }

    stage('Install Dependencies') {
      steps {
        sh '''
          for dir in auth tickets orders expiration payments client
          do
            if [ -f "$dir/package.json" ]; then
              cd $dir
              npm install
              cd ..
            fi
          done
        '''
      }
    }
    stage('SonarQube Analysis') {
      steps {
        withSonarQubeEnv('sonar') {
          withCredentials([string(credentialsId: 'jekins-ticketsystem', variable: 'SONAR_TOKEN')]) {
            sh '''
              sonar-scanner \
                -Dsonar.sources=. \
                -Dsonar.login=$SONAR_TOKEN
            '''
          }
        }
      }
    }
}
}

